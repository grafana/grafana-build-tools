#!/bin/sh

set -e
set -u

apt update
apt install -y binutils-gold binutils

GOPATH=${4:-"/build"}

env GOPATH="${GOPATH}" GOOS="${2}" GOARCH="${3}" go install "github.com/golangci/golangci-lint/cmd/golangci-lint@${1}"

# For native builds, the binary is found in build/bin/golangci-lint,
# but for cross builds, it is found in
# build/bin/${TARGET_GOOS}-${TARGET_GOARCH}/golangci-lint.
#
# Play some games with find and xargs to rename the binary to
# golangci-lint-v1 regardless of the architecture.
find "${GOPATH}/bin/" -name golangci-lint -print0 | xargs -I{} -r0 mv -v '{}' '{}-v1'
